<!DOCTYPE html><html lang="zh-Hans-CN"><head><meta charset="UTF-8"><title>过定点的贝塞尔曲线</title><meta name="author" content="hyrious"><meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="alternate" href="/feed.xml" type="application/rss+xml" title="hyrious.log"><link rel="stylesheet" crossorigin href="/i/index-D1JXHhEV.css"></head><body class="post"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><h2>过定点的贝塞尔曲线</h2><address>最后更新于 <time>2024-03-08</time></address><style>.μ0{color:#24292e;background-color:#fff}.μ1{color:#6a737d}.μ2{color:#005cc5}.μ3{color:#24292e}.μ4{color:#6f42c1}.μ5{color:#d73a49}.μ6{color:#e36209}@media(prefers-color-scheme:dark){.μ0{color:#e1e4e8;background-color:#24292e}.μ1{color:#6a737d}.μ2{color:#79b8ff}.μ3{color:#e1e4e8}.μ4{color:#b392f0}.μ5{color:#f97583}.μ6{color:#ffab70}}</style><blockquote><p>原文：<a target="_blank" rel="noopener" href="https://apoorvaj.io/cubic-bezier-through-four-points/">&laquo;Constructing a cubic Bezier that passes through four points&raquo;</a></p></blockquote><iframe src="/i/bezier-through-points.html" width="100%" height="300px"></iframe><p>将折线变为曲线有很多种算法，一个常规的方法是使用二阶贝塞尔 (含有一个控制点)，取每个相邻顶点组成的线段的中点作为起始/结束点，取顶点作为控制点：</p><pre class="shiki shiki-themes github-light github-dark μ0" tabindex="0"><code><span class="line"><span class="μ1">// 先连接一条直线到第一个中点</span></span>
<span class="line"><span class="μ2">M</span><span class="μ3"> p0 </span><span class="μ2">L</span><span class="μ4"> mid</span><span class="μ3">(p0, p1)</span></span>
<span class="line"><span class="μ1">// 将下一个顶点作为控制点，连接到下一个中点</span></span>
<span class="line"><span class="μ2">Q</span><span class="μ3"> p1 </span><span class="μ4">mid</span><span class="μ3">(p0, p1)</span></span>
<span class="line"><span class="μ5">...</span></span>
<span class="line"><span class="μ2">Q</span><span class="μ3"> p_n</span><span class="μ5">-</span><span class="μ2">2</span><span class="μ4"> mid</span><span class="μ3">(p_n</span><span class="μ5">-</span><span class="μ2">2</span><span class="μ3">, p_n</span><span class="μ5">-</span><span class="μ2">1</span><span class="μ3">)</span></span>
<span class="line"><span class="μ1">// 最后连接一条直线到最后一个中点</span></span>
<span class="line"><span class="μ2">L</span><span class="μ3"> p_n</span><span class="μ5">-</span><span class="μ2">1</span></span></code></pre><p>这个算法相当简单，而且注意到他是一个在线算法，即不需要等待所有输入都到达就能不断产生输出。但它有一个缺陷：几乎所有的顶点都不在曲线上。其实，只需要稍加修改即可让<q>在曲线上</q>这个条件成立一半：每次取两个顶点，一个作为控制点一个作为终点，这里就不贴代码了。不过这么一来其实曲线的精度损失了一部分，有没有更好的算法呢？</p><h3 id="一个简单的思路">一个简单的思路</h3><blockquote><p>出处：<a target="_blank" rel="noopener" href="https://agg.sourceforge.net/antigrain.com/research/bezier_interpolation/index.html">&laquo;Interpolation with Bezier Curves: A very simple method of smoothing polygons&raquo;</a><br>不过这个方法太简单了估计很多人也能自行想到。</p></blockquote><p>对于三阶贝塞尔，其实就是看是否能根据已有信息计算出最适合的控制点。假设我们有三个点形成一个角：</p><pre><code>        A
       /
   ?. /
     B------C
      `?
</code></pre><p>其实就是看如何找到上图中的 <code>?</code> 的位置。显然，控制点似乎和 AC 有关，不妨取 BA、BC 的中点 D、E，连接 DE。</p><pre class="shiki shiki-themes github-light github-dark μ0" tabindex="0"><code><span class="line"><span class="μ2">D</span><span class="μ5"> =</span><span class="μ4"> mid</span><span class="μ3">(</span><span class="μ2">B</span><span class="μ3">, </span><span class="μ2">A</span><span class="μ3">)</span></span>
<span class="line"><span class="μ2">E</span><span class="μ5"> =</span><span class="μ4"> mid</span><span class="μ3">(</span><span class="μ2">B</span><span class="μ3">, </span><span class="μ2">C</span><span class="μ3">)</span></span></code></pre><p>接下来平移 DE 到使得 B 在 DE 上，如何平移呢？不妨按 BA、BC 的长度比例，使得 DB : BE = BA : BC。</p><pre class="shiki shiki-themes github-light github-dark μ0" tabindex="0"><code><span class="line"><span class="μ3">p </span><span class="μ5">=</span><span class="μ4"> dis</span><span class="μ3">(</span><span class="μ2">B</span><span class="μ3">, </span><span class="μ2">A</span><span class="μ3">) </span><span class="μ5">/</span><span class="μ3"> (</span><span class="μ4">dis</span><span class="μ3">(</span><span class="μ2">B</span><span class="μ3">, </span><span class="μ2">A</span><span class="μ3">) </span><span class="μ5">+</span><span class="μ4"> dis</span><span class="μ3">(</span><span class="μ2">B</span><span class="μ3">, </span><span class="μ2">C</span><span class="μ3">))</span></span>
<span class="line"><span class="μ2">O</span><span class="μ5"> =</span><span class="μ2"> D</span><span class="μ5"> +</span><span class="μ3"> (</span><span class="μ2">E</span><span class="μ5"> -</span><span class="μ2"> D</span><span class="μ3">) </span><span class="μ5">*</span><span class="μ3"> p </span><span class="μ1">// 取 DE 上一点 O 符合比例</span></span>
<span class="line"><span class="μ2">D</span><span class="μ5"> =</span><span class="μ2"> D</span><span class="μ5"> +</span><span class="μ3"> (</span><span class="μ2">O</span><span class="μ5"> -</span><span class="μ2"> B</span><span class="μ3">) </span><span class="μ1">// 平移 DO 到 DB</span></span>
<span class="line"><span class="μ2">E</span><span class="μ5"> =</span><span class="μ2"> E</span><span class="μ5"> +</span><span class="μ3"> (</span><span class="μ2">O</span><span class="μ5"> -</span><span class="μ2"> B</span><span class="μ3">) </span><span class="μ1">// 平移 EO 到 EB</span></span>
<span class="line"><span class="μ1">// 现在 D、E 就是我们要找的控制点了</span></span></code></pre><h3 id="centripetal-catmullrom-spline-算法以及他的贝塞尔形式">Centripetal Catmull&ndash;Rom spline 算法以及他的贝塞尔形式</h3><p>贝塞尔曲线定义为两个顶点和一些控制点，而不是一列他需要经过的点 (我们最开始就是想要从一列输入点得到通过他们的曲线)，有没有一种曲线是定义为一组需要经过的点的呢？有，那就是 <a target="_blank" rel="noopener" href="http://www.cemyuksel.com/research/catmullrom_param/catmullrom_cad.pdf">Catmull-Rom 曲线</a>。贝塞尔曲线和 Catmull-Rom 曲线本质上都是用三次方程描述一条曲线，因此他们是可以互相转换的，下面就给出转换后的形式：</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:2.4271em;vertical-align:-.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">3</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:2.4271em;vertical-align:-.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">3</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-2.4519em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2481em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><!-- prettier-ignore --><p>其中 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.6644em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.0037em">α</span></span></span></span></span></span></span></span></span></span></span> 即和线段长度有关的一个值，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span></span></span></span> 取 0.5。代码如下：</p><!-- prettier-ignore --><pre class="shiki shiki-themes github-light github-dark μ0" tabindex="0"><code><span class="line"><span class="μ5">function</span><span class="μ4"> refit_bezier</span><span class="μ3">(</span><span class="μ6">p0</span><span class="μ3">, </span><span class="μ6">p1</span><span class="μ3">, </span><span class="μ6">p2</span><span class="μ3">, </span><span class="μ6">p3</span><span class="μ3">, </span><span class="μ6">t1</span><span class="μ3">, </span><span class="μ6">t2</span><span class="μ3">) {</span></span>
<span class="line"><span class="μ5">  let</span><span class="μ3"> d1 </span><span class="μ5">=</span><span class="μ3"> Math.</span><span class="μ4">pow</span><span class="μ3">(Math.</span><span class="μ4">hypot</span><span class="μ3">(p1.x </span><span class="μ5">-</span><span class="μ3"> p0.x, p1.y </span><span class="μ5">-</span><span class="μ3"> p0.y), </span><span class="μ2">0.5</span><span class="μ3">)</span></span>
<span class="line"><span class="μ5">  let</span><span class="μ3"> d2 </span><span class="μ5">=</span><span class="μ3"> Math.</span><span class="μ4">pow</span><span class="μ3">(Math.</span><span class="μ4">hypot</span><span class="μ3">(p2.x </span><span class="μ5">-</span><span class="μ3"> p1.x, p2.y </span><span class="μ5">-</span><span class="μ3"> p1.y), </span><span class="μ2">0.5</span><span class="μ3">)</span></span>
<span class="line"><span class="μ5">  let</span><span class="μ3"> d3 </span><span class="μ5">=</span><span class="μ3"> Math.</span><span class="μ4">pow</span><span class="μ3">(Math.</span><span class="μ4">hypot</span><span class="μ3">(p3.x </span><span class="μ5">-</span><span class="μ3"> p2.x, p3.y </span><span class="μ5">-</span><span class="μ3"> p2.y), </span><span class="μ2">0.5</span><span class="μ3">)</span></span>
<span class="line"><span class="μ1">  /* modify t1 */</span><span class="μ3"> {</span></span>
<span class="line"><span class="μ5">    let</span><span class="μ3"> a </span><span class="μ5">=</span><span class="μ3"> d1 </span><span class="μ5">*</span><span class="μ3"> d1, b </span><span class="μ5">=</span><span class="μ3"> d2 </span><span class="μ5">*</span><span class="μ3"> d2, c </span><span class="μ5">=</span><span class="μ2"> 2</span><span class="μ5"> *</span><span class="μ3"> a </span><span class="μ5">+</span><span class="μ2"> 3</span><span class="μ5"> *</span><span class="μ3"> d1 </span><span class="μ5">*</span><span class="μ3"> d2 </span><span class="μ5">+</span><span class="μ3"> b, d </span><span class="μ5">=</span><span class="μ2"> 3</span><span class="μ5"> *</span><span class="μ3"> d1 </span><span class="μ5">*</span><span class="μ3"> (d1 </span><span class="μ5">+</span><span class="μ3"> d2)</span></span>
<span class="line"><span class="μ3">    t1.x </span><span class="μ5">=</span><span class="μ3"> (a </span><span class="μ5">*</span><span class="μ3"> p2.x </span><span class="μ5">-</span><span class="μ3"> b </span><span class="μ5">*</span><span class="μ3"> p0.x </span><span class="μ5">+</span><span class="μ3"> c </span><span class="μ5">*</span><span class="μ3"> p1.x) </span><span class="μ5">/</span><span class="μ3"> d</span></span>
<span class="line"><span class="μ3">    t1.y </span><span class="μ5">=</span><span class="μ3"> (a </span><span class="μ5">*</span><span class="μ3"> p2.y </span><span class="μ5">-</span><span class="μ3"> b </span><span class="μ5">*</span><span class="μ3"> p0.y </span><span class="μ5">+</span><span class="μ3"> c </span><span class="μ5">*</span><span class="μ3"> p1.y) </span><span class="μ5">/</span><span class="μ3"> d</span></span>
<span class="line"><span class="μ3">  }</span></span>
<span class="line"><span class="μ1">  /* modify t2 */</span><span class="μ3"> {</span></span>
<span class="line"><span class="μ5">    let</span><span class="μ3"> a </span><span class="μ5">=</span><span class="μ3"> d3 </span><span class="μ5">*</span><span class="μ3"> d3, b </span><span class="μ5">=</span><span class="μ3"> d2 </span><span class="μ5">*</span><span class="μ3"> d2, c </span><span class="μ5">=</span><span class="μ2"> 2</span><span class="μ5"> *</span><span class="μ3"> a </span><span class="μ5">+</span><span class="μ2"> 3</span><span class="μ5"> *</span><span class="μ3"> d3 </span><span class="μ5">*</span><span class="μ3"> d2 </span><span class="μ5">+</span><span class="μ3"> b, d </span><span class="μ5">=</span><span class="μ2"> 3</span><span class="μ5"> *</span><span class="μ3"> d3 </span><span class="μ5">*</span><span class="μ3"> (d3 </span><span class="μ5">+</span><span class="μ3"> d2)</span></span>
<span class="line"><span class="μ3">    t2.x </span><span class="μ5">=</span><span class="μ3"> (a </span><span class="μ5">*</span><span class="μ3"> p1.x </span><span class="μ5">-</span><span class="μ3"> b </span><span class="μ5">*</span><span class="μ3"> p3.x </span><span class="μ5">+</span><span class="μ3"> c </span><span class="μ5">*</span><span class="μ3"> p2.x) </span><span class="μ5">/</span><span class="μ3"> d</span></span>
<span class="line"><span class="μ3">    t2.y </span><span class="μ5">=</span><span class="μ3"> (a </span><span class="μ5">*</span><span class="μ3"> p1.y </span><span class="μ5">-</span><span class="μ3"> b </span><span class="μ5">*</span><span class="μ3"> p3.y </span><span class="μ5">+</span><span class="μ3"> c </span><span class="μ5">*</span><span class="μ3"> p2.y) </span><span class="μ5">/</span><span class="μ3"> d</span></span>
<span class="line"><span class="μ3">  }</span></span>
<span class="line"><span class="μ3">}</span></span></code></pre><h3 id="fit-curve-离线算法">Fit curve 离线算法</h3><blockquote><p>出处：&laquo;Algorithm for Automatically Fitting Digitized Curves&raquo; by Philip J. Schneider, &quot;Graphics Gems&quot;, Academic Press, 1990. <a target="_blank" rel="noopener" href="https://github.com/odiak/fit-curve/blob/master/packages/fit-curve/src/index.ts">JavaScript 实现</a>、<a target="_blank" rel="noopener" href="https://github.com/soswow/fit-curve">另一个实现</a></p></blockquote><p>考虑到<q>拟合</q>目的，我们可以用牛顿二分法对原折线做切分，直到每个子折线都满足一定的误差要求。这个算法在 <a target="_blank" rel="noopener" href="http://paperjs.org/examples/path-simplification/">Papar.js</a> 里实现为一个路径简化算法。</p><p>这种算法算出的贝塞尔曲线是数据量最少且效果最好的，但是由于是离线算法，可能需要和别的算法结合使用。</p><footer><p><a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a> 2025 @ hyrious</p></footer></body></html>