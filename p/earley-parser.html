<!DOCTYPE html><html lang="zh-Hans-CN" data-critters-container><head><meta charset="UTF-8"><title>Earley 算法</title><meta name="author" content="hyrious"><meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="alternate" href="/feed.xml" type="application/rss+xml" title="hyrious.log"><style>*,:after,:before{box-sizing:border-box;background-repeat:no-repeat}:after,:before{text-decoration:inherit;vertical-align:inherit}:where(body){margin:0}:where(pre){font-family:monospace,monospace;font-size:1em;overflow:auto}:where(b,strong){font-weight:bolder}:where(code,kbd,samp){font-family:monospace,monospace;font-size:1em}:root{--title-color:#0d1117;--link-color:#0057ab;--link-bg-color:#deefff;--text-color:rgba(0, 0, 0, .8);--bg-color:#fff;--gray-color:#79828b;--pre-color:rgba(0, 0, 0, .05)}@media (prefers-color-scheme:dark){:root{--title-color:#dddddc;--link-color:#79c0ff;--link-bg-color:#263441;--text-color:rgba(255, 255, 255, .8);--bg-color:#0d1117;--gray-color:#747d86;--pre-color:rgba(255, 255, 255, .05)}}html{font-family:Chinese Quotes,Inter var,Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}code,pre{font-family:ui-monospace,Cascadia Mono,Consolas,Roboto Mono,"Ubuntu Monospace",Noto Mono,monospace,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:90%}body{margin:auto;padding:2ch;max-width:70ch;color:var(--text-color,#000);background-color:var(--bg-color,#fff);line-height:1.58;font-synthesis:style}@property --offset{syntax:"<length>";inherits:false;initial-value:0}a{color:var(--link-color,#000);text-decoration:underline solid;text-decoration-color:transparent;text-decoration-thickness:2px;text-underline-offset:var(--offset,.1em);transition:text-decoration-color .2s,--offset .2s;box-shadow:0 -.7em var(--link-bg-color,#deefff) inset}a:hover{cursor:pointer}a:focus,a:hover{text-decoration-color:var(--link-color,#000);--offset:.2em}@supports not (background:paint(something)){a{transition:text-decoration-color .2s,text-underline-offset .2s}a:focus,a:hover{text-underline-offset:.2em}}h2{font-weight:700;font-size:28px;line-height:34px;margin:21px 0 12px;color:var(--title-color,#000)}h4{font-size:20px;line-height:22px;margin:1.6rem 0 .6rem;color:var(--title-color,#000)}h2,h4{text-wrap:balance}footer{padding:2ch 0;color:var(--gray-color);position:sticky;top:100vh;font-variant-numeric:tabular-nums}address{font-style:normal;font-size:15px;line-height:18px;color:var(--gray-color,#79828b);margin-bottom:14px;font-variant-numeric:tabular-nums}p{margin:0 0 9px;line-height:1.75}.shiki{font-family:DM Mono,Input Mono,Fira Code,monospace;font-size:.92em;line-height:1.4;margin:.5em 0;padding:1ch 16px;border-radius:6px;background-color:var(--pre-color)!important}.shiki>code{display:block;padding:0}@media (prefers-color-scheme:dark){.shiki,.shiki span{color:var(--s-dark)!important}}footer a{color:inherit}footer a{box-shadow:unset}footer a:focus,footer a:hover{text-decoration-color:inherit}</style><link rel="preload" crossorigin href="/assets/index-vWxNvpCb.css" as="style"></head><body class="post"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><h2>Earley 算法</h2><address>最后更新于 <time>2017-09-27</time></address><ul><li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Earley_parser">Earley parser - Wikipedia</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bitpeach/p/3602522.html">模式识别之 Earley 算法入门详讲 - bitpeach</a></li></ul><p>Earley parser 是一个可以在最坏 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 的复杂度下解析任何 CFG 文法的产生式的算法，它是支持左递归的。</p><pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--s-dark-bg:#24292e;color:#24292e;--s-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#d73a49;--s-dark:#F97583">new</span><span style="color:#6f42c1;--s-dark:#B392F0"> EarleyParser</span><span style="color:#24292e;--s-dark:#E1E4E8">({ CFG }).</span><span style="color:#6f42c1;--s-dark:#B392F0">parse</span><span style="color:#24292e;--s-dark:#E1E4E8">(str) </span><span style="color:#6a737d;--s-dark:#6A737D">//=> AST</span></span></code></pre><p>设某条 CFG 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>α</mi><mi>β</mi></mrow><annotation encoding="application/x-tex">X \to \alpha \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span></span>，我们引入一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord">⋅</span></span></span></span> 代表解析位置，例如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>→</mo><mi>α</mi><mo>⋅</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">X \to \alpha \cdot \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span></span> 代表当前正在匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span></span></span></span> 规则，已经匹配成功了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span></span></span></span>，下一步是匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span></span>。</p><p>设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span> 是输入序列的第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span> 个 token 所在的位置，对于每个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span>，Earley 算法都要产生一个 State 集合。每个 State 形如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>→</mo><mi>α</mi><mo>⋅</mo><mi>β</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X \to \alpha \cdot \beta, i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>，代表我从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span> 位置开始匹配的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span></span></span></span> 规则，已经匹配成功了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span></span></span></span>，下一步是匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span></span>。设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 位置对应的 State 集合为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span>。</p><p>首先，生成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span></span></span></span>；接下来重复执行以下操作：</p><ul><li>预测：如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord">⋅</span></span></span></span> 后面是一个非终结符如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>→</mo><mi>α</mi><mo>⋅</mo><mi>Y</mi><mi>β</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X \to \alpha \cdot Y \beta, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">Y</span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">)</span></span></span></span>，我们把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.22222em">Y</span></span></span></span> 开头的规则添加到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span>（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 是当前位置，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.854em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span> 是刚才匹配 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span></span></span></span> 的起始位置）</li><li>扫描：如果 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord">⋅</span></span></span></span> 后面是一个终结符如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>→</mo><mi>α</mi><mo>⋅</mo><mi>a</mi><mi>β</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X \to \alpha \cdot a \beta, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">)</span></span></span></span>，我们把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>→</mo><mi>α</mi><mi>a</mi><mo>⋅</mo><mi>β</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X \to \alpha a \cdot \beta, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">)</span></span></span></span> 添加到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k + 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li><li>规约：对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span> 中的每个 State，如果它的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord">⋅</span></span></span></span> 到达该规则的末尾，如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>→</mo><mi>y</mi><mo>⋅</mo><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X \to y \cdot, j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mord">⋅</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">)</span></span></span></span>，说明我们已经匹配完成了这个（子）规则，在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">)</span></span></span></span> 中找到所有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋅</mo></mrow><annotation encoding="application/x-tex">\cdot</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord">⋅</span></span></span></span> 后面是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span></span></span></span> 的如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>Y</mi><mo>→</mo><mi>α</mi><mo>⋅</mo><mi>X</mi><mi>β</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(Y \to \alpha \cdot X \beta, i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.22222em">Y</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4445em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05278em">Xβ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>，将小圆点后移一位 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>Y</mi><mo>→</mo><mi>α</mi><mi>X</mi><mo>⋅</mo><mi>β</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(Y \to \alpha X \cdot \beta, i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.22222em">Y</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span> 添加到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span></li></ul><p>注意：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span> 是一个 <strong>集合</strong>，里面没有重复的 State。</p><p>设输入有 n 个 token，我们在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 中找到所有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6595em"></span><span class="mord mathnormal">i</span></span></span></span> 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">0</span></span></span></span> 的，说明我们已经匹配完成了全部的规则，找到的都是合法的生成树。</p><h4 id="简单实现">简单实现</h4><pre class="shiki shiki-themes github-light github-dark" style="background-color:#fff;--s-dark-bg:#24292e;color:#24292e;--s-dark:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#d73a49;--s-dark:#F97583">class</span><span style="color:#6f42c1;--s-dark:#B392F0"> Earley</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  def</span><span style="color:#6f42c1;--s-dark:#B392F0"> initialize</span><span style="color:#24292e;--s-dark:#E1E4E8"> rules </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#24292e;--s-dark:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">    @rules </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#24292e;--s-dark:#E1E4E8"> rules</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  def</span><span style="color:#6f42c1;--s-dark:#B392F0"> lazy_each_with_index</span><span style="color:#24292e;--s-dark:#E1E4E8"> arr, i </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#005cc5;--s-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    yield</span><span style="color:#24292e;--s-dark:#E1E4E8"> arr[i], (i </span><span style="color:#d73a49;--s-dark:#F97583">+=</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">) </span><span style="color:#d73a49;--s-dark:#F97583">-</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#d73a49;--s-dark:#F97583"> while</span><span style="color:#24292e;--s-dark:#E1E4E8"> arr[i]</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  def</span><span style="color:#6f42c1;--s-dark:#B392F0"> uniq_bfs</span><span style="color:#24292e;--s-dark:#E1E4E8"> start </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#24292e;--s-dark:#E1E4E8"> [], i </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#005cc5;--s-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    yield</span><span style="color:#24292e;--s-dark:#E1E4E8"> start[(i </span><span style="color:#d73a49;--s-dark:#F97583">+=</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">) </span><span style="color:#d73a49;--s-dark:#F97583">-</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">], </span><span style="color:#005cc5;--s-dark:#79B8FF">-></span><span style="color:#24292e;--s-dark:#E1E4E8"> x { start.push(x).uniq!; x } </span><span style="color:#d73a49;--s-dark:#F97583">while</span><span style="color:#24292e;--s-dark:#E1E4E8"> start[i]</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  def</span><span style="color:#6f42c1;--s-dark:#B392F0"> parse</span><span style="color:#24292e;--s-dark:#E1E4E8"> str, </span><span style="color:#d73a49;--s-dark:#F97583">&#x26;</span><span style="color:#24292e;--s-dark:#E1E4E8">lex</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">    s </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#24292e;--s-dark:#E1E4E8"> [[[@rules[</span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">], </span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">]]]</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">    lazy_each_with_index(s) { |set, k|</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">      s.push [] </span><span style="color:#d73a49;--s-dark:#F97583">if</span><span style="color:#24292e;--s-dark:#E1E4E8"> token </span><span style="color:#d73a49;--s-dark:#F97583">=</span><span style="color:#24292e;--s-dark:#E1E4E8"> lex.(str)</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">      uniq_bfs(set) { |((n, rule), i, j), u|</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">        if</span><span style="color:#24292e;--s-dark:#E1E4E8"> rule.size </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> i</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">          s[j].</span><span style="color:#005cc5;--s-dark:#79B8FF">select</span><span style="color:#24292e;--s-dark:#E1E4E8"> { |(_, rule), i, _| rule[i] </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> n }.each { |e, i, j| u.([e, i </span><span style="color:#d73a49;--s-dark:#F97583">+</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">, j]) }</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">        elsif</span><span style="color:#24292e;--s-dark:#E1E4E8"> rule[i].is_a? </span><span style="color:#005cc5;--s-dark:#79B8FF">Symbol</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">          @rules.</span><span style="color:#005cc5;--s-dark:#79B8FF">select</span><span style="color:#24292e;--s-dark:#E1E4E8"> { |e, _| rule[i] </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> e }.each { |e| u.([e, </span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">, k]) }</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">        elsif</span><span style="color:#24292e;--s-dark:#E1E4E8"> match rule[i], token</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">          s[k </span><span style="color:#d73a49;--s-dark:#F97583">+</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">].push [[n, rule], i </span><span style="color:#d73a49;--s-dark:#F97583">+</span><span style="color:#005cc5;--s-dark:#79B8FF"> 1</span><span style="color:#24292e;--s-dark:#E1E4E8">, j]</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">        end</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">    s[</span><span style="color:#d73a49;--s-dark:#F97583">-</span><span style="color:#005cc5;--s-dark:#79B8FF">1</span><span style="color:#24292e;--s-dark:#E1E4E8">].any? { |(n, rule), i, j| n </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> @rules[</span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">][</span><span style="color:#005cc5;--s-dark:#79B8FF">0</span><span style="color:#24292e;--s-dark:#E1E4E8">] </span><span style="color:#d73a49;--s-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292e;--s-dark:#E1E4E8"> rule.size </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> i </span><span style="color:#d73a49;--s-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292e;--s-dark:#E1E4E8"> j.zero? }</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  def</span><span style="color:#6f42c1;--s-dark:#B392F0"> match</span><span style="color:#24292e;--s-dark:#E1E4E8"> pattern, token</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    case</span><span style="color:#24292e;--s-dark:#E1E4E8"> pattern</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    when</span><span style="color:#005cc5;--s-dark:#79B8FF"> String</span><span style="color:#d73a49;--s-dark:#F97583"> then</span><span style="color:#24292e;--s-dark:#E1E4E8"> token </span><span style="color:#d73a49;--s-dark:#F97583">==</span><span style="color:#24292e;--s-dark:#E1E4E8"> pattern</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    when</span><span style="color:#005cc5;--s-dark:#79B8FF"> Regexp</span><span style="color:#d73a49;--s-dark:#F97583"> then</span><span style="color:#24292e;--s-dark:#E1E4E8"> token </span><span style="color:#d73a49;--s-dark:#F97583">=~</span><span style="color:#24292e;--s-dark:#E1E4E8"> pattern</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    else</span><span style="color:#005cc5;--s-dark:#79B8FF"> false</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">    end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">  end</span></span>
<span class="line"><span style="color:#d73a49;--s-dark:#F97583">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005cc5;--s-dark:#79B8FF">p</span><span style="color:#005cc5;--s-dark:#79B8FF"> Earley</span><span style="color:#24292e;--s-dark:#E1E4E8">.</span><span style="color:#d73a49;--s-dark:#F97583">new</span><span style="color:#24292e;--s-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:P</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#032f62;--s-dark:#9ECBFF">'+'</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#032f62;--s-dark:#9ECBFF">'-'</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:S</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#032f62;--s-dark:#9ECBFF">'*'</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#005cc5;--s-dark:#79B8FF">:T</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#032f62;--s-dark:#9ECBFF">'/'</span><span style="color:#24292e;--s-dark:#E1E4E8">, </span><span style="color:#005cc5;--s-dark:#79B8FF">:T</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:M</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#005cc5;--s-dark:#79B8FF">:T</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  [</span><span style="color:#005cc5;--s-dark:#79B8FF">:T</span><span style="color:#24292e;--s-dark:#E1E4E8">, [</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#032f62;--s-dark:#DBEDFF">^</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\d</span><span style="color:#032f62;--s-dark:#DBEDFF">+$</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#24292e;--s-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">]).parse(</span><span style="color:#032f62;--s-dark:#9ECBFF">'2 + 3 - 4'</span><span style="color:#24292e;--s-dark:#E1E4E8">) { |s|</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  s.slice!(</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#032f62;--s-dark:#DBEDFF">^</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\s</span><span style="color:#032f62;--s-dark:#DBEDFF">+</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#24292e;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">  s.slice!(</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#032f62;--s-dark:#DBEDFF">^</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\d</span><span style="color:#032f62;--s-dark:#DBEDFF">+|</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\+</span><span style="color:#032f62;--s-dark:#DBEDFF">|</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\-</span><span style="color:#032f62;--s-dark:#DBEDFF">|</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\*</span><span style="color:#032f62;--s-dark:#DBEDFF">|</span><span style="color:#22863a;--s-dark:#85E89D;font-weight:700;--s-dark-font-weight:bold">\/</span><span style="color:#032f62;--s-dark:#9ECBFF">/</span><span style="color:#24292e;--s-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292e;--s-dark:#E1E4E8">}</span></span></code></pre><h4 id="最后">最后</h4><p>Earley parser 是一个自顶向下的算法，有一个与之类似的操作叫 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/CYK_algorithm">CYK 算法</a> 是自下而上的。</p><footer><p><a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a> 2023 @ hyrious</p></footer><link rel="stylesheet" href="/assets/index-vWxNvpCb.css"></body></html>