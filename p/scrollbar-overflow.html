<!DOCTYPE html>
<html lang="zh-Hans-CN">
<head>
  <meta charset="UTF-8">
  <title>为什么网页在 Windows 上溢出了</title>
  <meta name="color-scheme" content="light dark">
  <meta name="viewport" content="width=device-width">
  <link rel="icon" href="../favicon.ico">
  <link rel="stylesheet" href="../style.css">
</head>
<body class="post">
  <h2>为什么网页在 Windows 上溢出了</h2>
  <address>最后更新于 <time>2023-03-25</time></address>

<p>不知道你们是否有过这种体验：网页在 Windows 浏览器上（或者插了鼠标的 Mac 上）出现了莫名其妙的内容溢出，即横向或纵向多了一些滚动区域。这通常是因为错误地使用了 <code>vw</code>、<code>vh</code> 等 CSS 单位，下面就来看看如何解决这类问题。</p>
<h3 id="如何让元素撑满窗口">如何让元素撑满窗口？</h3>
<p>这是继“如何居中<samp>DIV</samp>”后又一个日经问题。由于根元素本身的 <code>height</code> 是 <code>auto</code>，其内容元素即使有 <code>height: 100%</code> 也最终会变成按里面的内容计算：</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: auto&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 100%&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><code>html</code>：我的高度按内容计算<br><code>body</code>：我的高度要撑满父元素，但父元素没有自己的高度，所以我的高度回退到 <code>auto</code></p>
<p>所以很简单，只需要把 <code>html</code> <code>body</code> 这条线上的元素都设好 <code>height: 100%</code> 就行。</p>
<pre><code class="language-css"><span class="hljs-selector-tag">html</span>,
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}
</code></pre>
<h4 id="为什么我的网页开始出现纵向滚动条了">为什么我的网页开始出现纵向滚动条了？</h4>
<p>如果你在 chrome 系浏览器上试了一下上面的 CSS，会发现出现了纵向“溢出”。怎么会事捏？原来，这是由于 chrome 默认在 <code>body</code> 元素上有一个 <code>margin: 8px</code>，而在两种盒模型里 <code>width</code>、<code>height</code> 都不含 <code>margin</code>，所以多余的 <code>margin</code> 会使元素变得更大。所以最终 <code>body</code> 的高度实际上是 100% + 8px + 8px。</p>
<p>解决它很简单，我们再把这个碍事的 <code>margin</code> 去掉即可：</p>
<pre><code class="language-css"><span class="hljs-selector-tag">html</span>,
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
}
</code></pre>
<h4 id="你说的对但是-100vh">你说的对，但是 <code>100vh</code></h4>
<p>上面的做法必须得从根元素 <code>html</code> 开始一层层往下铺 <code>height: 100%</code>，有没有一键顶穿屏幕的呢？确实有，可以用 <code>100vw</code>、<code>100vh</code> 精确表示完整的屏幕大小。</p>
<pre><code class="language-css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
}
</code></pre>
<p>“这太简单了”，你想。但事实并非如此，不妨试试往其中加入超出屏幕的内容。</p>
<p>WTF？这时居然同时出现了左右和上下的滚动条。</p>
<p>这是因为，<code>vw</code> 不受滚动条影响，当浏览器决定用滚动条“挤一挤”内容的时候你就输了。而大部分 macOS 开发者在使用触摸板时，系统会显示覆盖渲染的滚动条，它总是不影响内容，所以这是很多 macOS 开发者容易忽视的地方。</p>
<p>手机用户就更悲催了，因为手机浏览器顶部的地址栏会随着滚动收起来，而 <code>vh</code> 的计算不受这个栏影响，结果就是要么内容区少了一截，要么溢出一部分看不见。</p>
<p>所以，在实现撑满元素的时候，尽量别用 <code>vw</code> 等单位，会带来不幸。</p>
<h3 id="其他方式">其他方式</h3>
<p>我不管父元素辣：</p>
<pre><code class="language-css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>; <span class="hljs-comment">/* top/left/right/bottom: 0 的缩写 */</span>
}
</code></pre>
<p><code>position: fixed</code> 也可以，不过可能会导致二级 <code>fixed</code> 的定位计算以及一些 <code>transform</code> 坐标计算出现问题，轻易不要使用。</p>
<h3 id="其他思考">其他思考</h3>
<p>现在的网页越来越从“像报纸”到“像软件”，起手铺满屏幕看似基操，实则可能会失去一些原来像报纸那样的体验。例如，在网页上搜索内容时，chrome 会在滚动条上显示出高亮的线方便定位。但这仅限于原来网页确实有这么高的内容的情况，如果一开始就是 <code>height: 100vh</code>，那这个功能很有可能失效。</p>
<p>GitHub 这方面就做得很好，利用好 <code>position: fixed</code>，也可以在制造出像应用的体验的同时保留原来像报纸一样静态内容的优势。</p>

  <footer>
    <p><a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a> 2022 @ hyrious</p>
  </footer>
</body>
</html>
