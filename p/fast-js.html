<!DOCTYPE html><html lang="zh-Hans-CN"><head><meta charset="UTF-8"><title>如何编写更快的 JS</title><meta name="author" content="hyrious"><meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="alternate" href="/feed.xml" type="application/rss+xml" title="hyrious.log"><link rel="stylesheet" crossorigin href="/i/index-hGvNEOzF.css"></head><body class="post"><h2>如何编写更快的 JS</h2><address>最后更新于 <time>2022-01-28</time></address><p>这篇博客主要是对 4 年前的这篇 <q><a target="_blank" rel="noopener" href="https://mrale.ph/blog/2018/02/03/maybe-you-dont-need-rust-to-speed-up-your-js.html">Maybe you don&#39;t need Rust and WASM to speed up your JS</a></q> 的笔记。</p><p><strong>注意</strong>：过早优化是万恶之源，了解这篇博客<strong>可能</strong>有助于你写出更快的 JS/TS，但是不要一味追求写出让人看不懂的代码。</p><ol><li>调用函数时传递和声明一样多的参数，不使用可选参数。</li><li><a target="_blank" rel="noopener" href="https://mrale.ph/blog/2015/01/11/whats-up-with-monomorphism.html">单态化</a>函数，简单来说让每个参数的形状（对象的结构、或者函数本身）都永远不变。这个招式平时比较难搓，建议看前面的文章详细理解。</li><li>克制地使用缓存 —— 除非查找它比计算它容易。</li><li>想办法减少 GC 的压力，例如申请一个大的 TypedArray 存储定长数据。</li><li>如果只是在 <code>ASCII</code> 范围内工作，用 <code>Uint8Array</code> 代替 <code>String</code>。</li></ol><p>还有一些常识：</p><ol><li>用 <code>class</code> 维护对象的形状，不去改变 <code>prototype</code>。</li><li>从<q>维护形状</q>考虑，不要用 <code>Record&lt;string, X&gt;</code> 当 <code>Map/Set</code> 使 —— 直接用 <code>Map</code> 即可。</li></ol><footer><p><a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a> 2023 @ hyrious</p></footer></body></html>